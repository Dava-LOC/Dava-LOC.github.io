jQuery(document).ready(function(e){function t(t){let l=m?e(".epbl-tm-section-template").first().clone(!0):s.closest(".epbl-tm-preset-template").clone(!0),a=l.find(".epbl-template-edit-url").attr("href").replace("template_id=0","template_id="+t.template_id);if(l.attr("data-template-id",t.template_id),l.find(".epbl-template-edit-url").attr("href",a),l.find(".epbl-tm-section-template__header__info__name").contents().first()[0].textContent=t.template_name,l.find(".epbl-tm-section-template__header__info__disc").text(t.template_description),m){let e=s.closest(".epbl-tm-section-preset").find(".epbl-tm-section-preset__preview").clone(!0);l.find(".epbl-tm-section-template__preview").html(e)}l.css("display","block"),e(".epbl-tm-no-heading-message").hide(),e(".epbl-admin-info-box-container").hide(),e("#epbl-tm-template-panel").append(l),e(".epbl-tm-tab-nav-container li").trigger("click")}function l(t){s.closest(".epbl-tm-preset-template").find(".epbl-tm-section-template__header__info__name").text(t.template_name),s.closest(".epbl-tm-preset-template").find(".epbl-tm-section-template__header__info__disc").text(t.template_description),e("#epbl_tm_template_name").text(""),e("#epbl_tm_template_description").text(""),e(".epbl-template-manager-container #epbl_tm_template_name_change_dialog").css("display","none")}function a(){s.closest(".epbl-tm-preset-template").remove(),e(".epbl-tm-template-counter").length<2&&(e(".epbl-tm-no-heading-message").show(),e(".epbl-admin-info-box-container").show())}function n(t){e(".epbl-template-manager-container").attr("data-block-name",t.blockName),e("#epbl-tm-preset-panel").html(t.presets),e("#epbl-tm-template-panel").html(t.templates)}function i(t,l,a,n="",i=""){o("POST",{action:t,nonce:e("#_wpnonce_epbl_template_manager_action").val(),templateId:s.closest(".epbl-tm-preset-template").attr("data-template-id"),blockType:s.closest(".epbl-tm-preset-template").attr("data-template-type"),blockName:e(".epbl-template-manager-container").attr("data-block-name"),templateName:n,templateDescription:i},l,a)}function o(t,l,a,n){let i="Error Occurred",o="",p="",s="";e.ajax({type:t,dataType:"json",data:l,url:ajaxurl,beforeSend:function(t){!function(t){e(".epbl-admin-dialog-box-status").remove();let l='<div class="epbl-admin-dialog-box-loading"><div class="epbl-admin-dbl__header"><div class="epbl-admin-dbl-icon epbl epbl-hourglass-half"></div>'+(t?"<h4>"+t+"</h4>":"")+"</div></div>";e("body").append(l)}(a)}}).done(function(e){(s=e||"").error||"success"!==s.status?(i=s.title?s.title:"",o=s.message?s.message:"Please try again later. (L01)"):p=s.result?s.result:""}).fail(function(e,t,l){o=l?" ["+l+"]":"unknown error"}).always(function(){""===o?(!function(t,l){e(".epbl-admin-dialog-box-status").hasClass("epbl-admin-dialog-box-status--success")&&e(".epbl-admin-dialog-box-status").remove();e(".epbl-admin-dialog-box-status").hasClass("epbl-admin-dialog-box-status--info")&&e(".epbl-admin-dialog-box-status").remove();e(".epbl-admin-dialog-box-loading").remove();let a='<div class="epbl-bottom-notice-message epbl-bottom-notice-message--'+l+'">'+(t||"")+"</div>";e("body").append(a),setTimeout(function(){e(".epbl-bottom-notice-message").addClass("fadeOutDown")},3e3)}("Completed","success"),n&&n(p)):function(t,l,a){e(".epbl-admin-dialog-box-status").remove(),e(".epbl-admin-dialog-box-loading").remove();let n="";switch(a){case"success":n="epbl-check";break;case"info":n="epbl-info";break;case"warning":n="epbl-exclamation-triangle";break;case"error":n="epbl-exclamation"}let i="";"error"!==a&&"warning"!==a||(i='<div class="epbl-admin-dbs__footer"><div class="epbl-admin-dbs__footer__close">Close</div></div>');let o='<div class="epbl-admin-dialog-box-status epbl-admin-dialog-box-status--'+a+'"><div class="epbl-admin-dbs__header"><div class="epbl-dbs-icon epbl '+n+'"></div>'+(t?"<h4>"+t+"</h4>":"")+'</div><div class="epbl-admin-dbs__body">'+(l||"")+"</div>"+i+"</div>";e("body").append(o),e(".epbl-admin-dbs__footer__close").on("click",function(){e(".epbl-admin-dialog-box-status").remove()})}(i,o,"error")})}function p(){e(".epbl-tm-dialog-box-form").hide(),e(".epbl-admin-dialog-box-confirmation").hide()}let s,m=!1;e(".epbl-tm-panel-container").on("click",".epbl-tm-section-preset__header__controls__copy",function(l){l.preventDefault(),s=e(this),m=!0,p(),i("epbl-template-mgr-copy","Copying preset",t)}),e(".epbl-tm-section-template__header__controls__copy").on("click",function(l){l.preventDefault(),s=e(this),m=!1,p(),i("epbl-template-mgr-copy","Copying template",t)}),e(".epbl-template-manager-container").on("click",".epbl-tm-section-template__header__controls__rename",function(t){t.preventDefault(),s=e(this),p(),e("#epbl_tm_template_name_change_dialog").css("display","block")}),e("#epbl-tm-accept-button").on("click",function(t){t.preventDefault(),i("epbl-template-mgr-rename","Updating template",l,e("#epbl_tm_template_name").val(),e("#epbl_tm_template_description").val())}),e(".epbl-template-manager-container").on("click",".epbl-tm-section-template__header__controls__delete",function(t){t.preventDefault(),s=e(this),p(),e("#epbl_tm_delete_template_confirmation").css("display","block")}),e("#epbl_tm_accept_delete_template").on("click",function(t){e("#epbl_tm_delete_template_confirmation").css("display","none"),i("epbl-template-mgr-delete","Deleting template",a)}),e(".epbl-template-manager-container").on("click",".epbl-preset-group-link",function(t){t.preventDefault(),s=e(this),p();let l=this.textContent;if(!l)return;let a=document.getElementsByClassName("epbl-tm-preset-template");for(let e=0;e<a.length;e++)l===a[e].getAttribute("data-group-name")?a[e].style.display="block":a[e].style.display="none"}),e(".epbl-tm-block-type-selection li").on("click",function(t){e(".epbl-tm-block-type-selection li").removeClass("epbl-tm-block-type-selection__list-item--active-tab"),e(this).addClass("epbl-tm-block-type-selection__list-item--active-tab");o("POST",{action:"epbl-template-mgr-get-presets-templates-page",nonce:e("#_wpnonce_epbl_template_manager_action").val(),blockName:e(t.currentTarget).attr("data-block-name")},"Loading templates",n)}),e(".epbl-tm-tab-nav-container li").on("click",function(){let t=e(this).attr("id");e(".epbl-tm-panel").hide(),e(".epbl-tm-tab-nav-container li").removeClass("epbl-active-tab"),e("#epbl-tm-"+t+"-panel").show(),e(this).addClass("epbl-active-tab")}),e(".epbl-template-manager-container").on("click"," .epbl-tm-section-preset__header__info__config",function(){e(this).parents(".epbl-tm-section-preset__header").toggleClass("epbl-tm-section-preset__header--show-settings")}),e(".epbl-template-manager-container").on("click"," .epbl-tm-section-template__header__info__config",function(){e(this).parents(".epbl-tm-section-template__header").toggleClass("epbl-tm-section-template__header--show-settings")}),e(".epbl-admin-dbc__close").on("click",function(){e(".epbl-admin-dialog-box-confirmation").hide()}),e(".epbl-admin-dbc__footer__cancel").on("click",function(){e(".epbl-admin-dialog-box-confirmation").hide()}),e(".epbl-tm-dbf__close").on("click",function(){e(".epbl-tm-dialog-box-form").hide()}),e(".epbl-tm-dbf__footer__cancel").on("click",function(){e(".epbl-tm-dialog-box-form").hide()})});